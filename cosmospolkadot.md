为就在今晨，2019年3月14日7时08分(UTC+8)，Cosmos主网成功上线。 (一)Tendermint共识机制
在看完Gavin的现场演示后，有人感慨:“一键发币的时代已经落幕了，现在是一键发链的 时代了。” Gavin使用的技术叫做Substrate，一个搭建区块链的开发框架，有了这个框架，底层的P2P 网络、POW/POS等共识算法之类的基础协议都能非常便捷的完成，同时还支持修改与编 辑。
Cosmos也在去年11月发布了SDK 0.25，使用SDK来开发自己的链，可以做到和Substrate 类似的效果。
Cosmos的核心之一，是它采用的共识机制模式——Tendermint。
2014 年， 作为首批在 PoS 权益证明区块链的背景下探索拜占庭容错方向的研究人员之 一，Jae Kwon发表了《Tendermint:无挖矿的共识》白皮书。Tendermint 的基本思想是 允许大量分布式节点就共识达成一致，而无需中本聪共识依赖的 PoW 工作量证明挖矿。中 本聪共识是在多个节点之间分配信任的重大突破，但有局限性，比如速度慢、要浪费网络 外部的资源才能达成共识等等。
Tendermint 共识算法是第一个引入 staking 权益质押、验 证、领导轮流选举的算法，一组验证人 (Validator)代替了矿工(Miner)的角色，依据 抵押的权益比例轮流出块，以改善中本聪共识的局限性。
tendermint同时是拜占庭容错的(Byzantine Fault Tolerance)，因此对于3f+1个 验证节 点组成的区块链，即使有f个节点出现拜占庭错误，也可以保证全局正确共识的达成。同时 在极端环境下，tendermint在交易安全与停机风险之间选择了安全，因此当超过f个验证节 点发生故障时，系统将停止工作。
什么是拜占庭错误?简单的说就是任何错误:既包括节点宕机、也包括恶意节点的欺骗和 攻击。
tendermint共识机制的另一个特点就是其共识的最终确定性:一旦共识达成就是真的达成， 而不是像比特币或以太坊的共识是一种概率性质的确定性，还有可能在将来某个时刻 失效。 因此在tendermint中基本上不会出现区块链分叉的情况。



(二)跨链如何实现?
要理解cosmos跨链实现过程，有两个关键词——
IBC协议，Hub模式
IBC(Inter-Blockchain Communication)，即 Cosmos 的跨链通信协议。IBC 定义了链与 链之间的通信标准，具有相同结构的链就可以实现互相连通，它允许区块链读取和验证同 结构的其他链上的事件。利用 Cosmos SDK 开发的公链天然具备这一跨链结构，它们之间 从创立之初就可以通过 IBC 实现链链交互。
  2/6
那些不是使用 Cosmos SDK 开发，未包含 IBC 跨链标准的链怎么连通?方法是使用 Cosmos SDK 为原链开发一条「代理链」。这条代理链既遵守原链的通信标准，可以与原 链连通;又采用 IBC 协议，可以与其他 Cosmos SDK 开发的链连通，从而间接实现了原链 与 Cosmos 链的跨链。
Cosmos 跨链实现中的另一个重要角色是「Hub」，它承担的是中间枢纽的角色。在没有 Hub 的情况下要实现连接，就必须在彼此之间新建一条通道，但如果有了 Hub，它们都只 需要与 Hub 连接，由 Hub 实现跨链的中转。Hub 本身也是一条公链，使用 Cosmos SDK 开发，具备 tendermint 结构;Hub 连接的公链以及公链的代理链被称作「Zone」，所有 的 Zone 都需要实现 IBC 通信标准。


(三)代币Atom
Cosmos Hub 的主要代币是 Atom，其主要用于抵押和链的治理。Cosmos Hub 启动之初 有 100 个验证人，并将逐年增加。Atom 持有者既可以是验证人也可以是委托人。验证人 需要设置一个完全节点，用于维护网络安全和处理交易。委托人则可以根据他们对验证人 的信赖度和节点运行能力的判断，将代币委托给验证人。
验证人会代理 Atom 资产，并从每个出块中获得 Atom 奖励。这些奖励会惠及委托人，只 是其中一小部分将被扣留，以用于验证节点的日常运行。为了保证验证人的诚实性，向区 块链发布不正确数据的恶意验证人会失去他们的 Atom 代币作为经济处罚。这种机制称为 「slashing」。
创世区块上的 Atom 代币以及验证人的初次分发为:Cosmos 众筹参与者持有75%，预售 参与者持有 5%， Cosmos 网络基金会持有 10%， ALL IN BITS 集团持有 10%。从创世块 之后，每年 Atom 总量的 1/3 都会作为奖励分发给担保验证人及委托人。
cosmos的众筹在2017年4月6日进行，不到半个小时便宣告完成。全球参与人数为1090 人，按照单价0.1USD一共售卖了约1亿7千万个Atom，融到246900个ETH和4870个BTC， 折合价值1700万美元，其中1ETH兑换452.3Atom，1BTC兑换11656.5Atom。另外会为开 发团队和基金会各增发10%的ATOM。四个月后，波卡也开启了众筹，完成金额是1.3亿美 元。
Cosmos的众筹逻辑是为每个参与者生成了一个12个助记词组成的私钥，并分配了一个将来 Cosmos链上的用户地址，但没有像其他ERC20项目一样提供ETH链上的转账和交易功能， 而是直接锁仓直到主网上线。
(四)主网上线详细规划
  4/6
今天的主网上线只是第一步，Cosmos将具体其分成了三个阶段。 
第一阶段:网络逐步趋于稳定
在第一阶段，主网可能会不太稳定，也许会出现暂停或其他故障，可能需要Cosmos主网验 证人和全节点运营者们一起来协助修复。在网络趋于稳定过程中，出现此类故障并不意 外。
总而言之，如果在链上交易功能开启之前，Cosmos Hub发现任何错误或漏洞，那么用户可 期望回滚至任意状态，甚至创世区块。而一旦链上交易功能开始后，状态回滚方式将很难 被采纳，除非出现类似以太坊“DAO事件”的极端情况。
第二阶段:链上交易开启
一旦我们认为主网足够稳定，在链上抵押了Atom的通证持有者将会通过链上治理过程投票 决定是否开启链上交易。可以通过Cosmos官网提供的浏览器进行治理提案的状态。 (浏览 器地址:https://cosmos.network/launch)
对用户来说，如果链上交易开启，就可以在链上进行Atom转账了。
第三阶段:启用IBC协议
第三阶段将会发布IBC协议，并且对是否将其纳入Cosmos-SDK的核心模块库进行链上治理 投票。
对开发人员来说，此时将可以使用Cosmos-SDK或Tendermint BFT构建的应用专有链将能 够连接到 Cosmos Hub，并与连接到Hubs上的其他任意区块链进行跨链交互。
对用户来说，可以将各种通证和NFT直接从采用IBC协议连接的一个链转移到另一个通过IBC 协议连接的链，而无需通过第三方的中心化平台。


技术设计和协议 Tendermint (共识和网络)
Tendermint 是一种实用拜占庭容错(PBFT)状态机。它需要一组已知的验证人达成共识 而出块。在 Cosmos 网络中，至少需要 2/3 的验证人达成共识。假设不到 1/3 的验证人是 作恶者，则网络永远不会分叉，因为验证人不能在相同高度提交冲突块。这种策略正是根 源于 Tendermint 中安全性优先于活跃度的原则。
tendermint可以实现很高的交易吞吐量。根据官方的说法，在 合理（理想）的应用数据结构支持下，可以达到42000交易/秒，引文参考 这里。 不过在现实环境中，部署在全球的100个节点进行共识沟通，实际可以达到1000交易/秒。

应用区块链接口(ABCI)
ABCI 是定义了复制引擎(Tendermint)和状态机(区块链)两者边界的接口。ABCI 是区 块链状态更新的唯一通道，而只有 Tendermint 才具有区块链状态更改功能。这种设计是 一种非常棒的安全策略，因为改变状态只有一个接入通道。

 |特性 | 共同      | Cosmos                                       | Polkadot                 | 
 | ------------- | -------------------------------------------- | ------------------------ | --------------- |
 | 共识协议       | Tendermint  PBFT 共识算法                    |                          | Aurand      |          
 | 代币和PoS设计  | 治理和股权代理的代币，有保护网络安全的验证人 |        | 校对人（用于帮助处理Parachain）和渔夫（用于密切监视网络中的作恶者） |
| 治理           |            | 验证人，委托人和成文宪法 | 设置了自适应仲裁偏差，一个验证人组成的理事                  |
| 安全性         |                                              | 去中心化的安全模型       | 共享安全模型         |
| 速度和可扩展性 | 1000TPS                                      | Zone                     | Parachain        |
| 可互操作性     | 链中继                                       | Peg Zone                 | Bridges  |
| 开发语言       |                                        | Golang               | WebAssembly和Rust   |
| 开发框架       |                                              | Cosmos SDKLotion-JS      | Substrate |
| 主网启动       |                                              | 2018年Q3                 | 2019年Q3    |



名称|COSMOS| POLKADOT
| ---- |---|  -  |
|代币|ATOM|DOT|
|行业| 区块链服务| 区块链服务|
| ICO hard cap| 上涨4,868 BTC + 246,892 ETH（截至2017年4月6日） |筹集资金超过3.59亿美元（截至2017年10月26日）|
| ICO价格|_____|多样|
|合作伙伴数量|_____|12|
|电报粉丝| 5377粉丝| 没有电报频道|
|项目开始日期| 2016年2月| 2016年10月|


NAME|	COSMOS	|POLKADOT
|----|---|--|
|Token|	ATOM|	DOT|
|Industry|	Blockchain Services|	Blockchain Services|
|ICO Hard Cap	Raised 4,868 BTC + 246,892 ETH (as at April 6, 2017).|	Raised over $359 million (as at October 26, 2017).|
|ICO Price|	_____|	varied|
|Number of Partners|	_____	|12|
|Telegram Followers	|5377 followers|	No Telegram Channel|
|Project Start Date|	February 2016|	October 2016|



POLKADOT COSMOS
Easy-to-use platform with non-complex & minimal functionality.|	A developer friendly platform equipped with a Tendermint-based toolkit that makes building DApps easy.|
STRENGTHS	Raised $359 million during ICO.	Their roadmap is 90% complete.

Polkadot aims to provide developers that want to deploy smart contracts on their platform with Turing-complete parachains	Chains built on Cosmos are interoperable among themselves as well as with external blockchains.
WEAKNESSES	The network won’t be launched till Q3 2019.	Their website does not mention any notable partnerships.
Ethereum is already working on a solution to its scalability problem. This may remove a significant part of both project’s target market


共识协议
它们都使用Tendermint进行PBFT共识，尽管Polkadot承诺将使用与Aurand相辅的混合共识协议。混合共识方案加速了共识的形成，但它也导致了区块回收的可能。两种方案都还需要在实时区块链网络中经受实践检验。当然，两种共识协议也远快于以太坊和比特币网络的PoW共识。

Polkadot还在他们的网站上提到将使用“积极的BFT权威证明（Optimistic BFT Proof of Authority）”，但我们尚不清楚它们具体是指什么。Web3基金会最近表示，“Polkadot被设计为完全开放和公开的，不需要由任何特定的组织或可信的权威来维护”。从Polkadot在白皮书中提出的整体设计来看，显然，Dots的PoS证明将在共识中占据主导地位。即使PoA证明（Proof-of-authority）最终会使用，也只可能是个次要角色。

代币和PoS设计
它们都有用于治理和股权代理的代币。两个网络都有保护网络安全的验证人，和可将代币委托给验证人的委托人/提名人。Polkadot 网络中还加入了校对人（用于帮助处理Parachain）和渔夫（用于密切监视网络中的作恶者）。两个项目都有对作恶者的惩罚措施，并在主网上线时，相应的惩罚指标可能会进行调整和测试。总结来说，Polkadot的PoS共识设计更为精妙，但也更加复杂。

Cosmos的优势在于他们将首先发布主网，并且相对简单的设计也使股权利益人更容易组织和创建稳定的去中心化网络。Polkadot的优势在于，四种股权利益人的配置可以使网络变得更加去中心化。现在很难说两个项目的设计孰优孰劣，但时间会给出答案。

治理
Cosmos在治理方面的协议并不复杂，因为它仅仅依靠验证人，委托人和成文宪法。

Polkadot在治理方面更加完备，它还设置了自适应仲裁偏差，以及一个验证人组成的理事会，用于处理没有得到股权利益人重视的提案。

实时区块链中的PoS治理在很大程度上未经过测试。我们可以期望，这两个项目团队都能够提出对应的解决方案，以便在测试之初调整治理协议。这两种设计模型都足够简洁，可以通过小规模的迭代和改进，过渡到一个更强大的去中心化治理系统。一开始就强加一堆制度和规则的方法不可取，还不如从简单的开始，逐渐增加复杂性。这也是这两个项目的高明之处。

网络也需要足够得去中心化，以防止某些恶意的验证人控制整个网络。值得庆幸的是，这将使他们能够避免EOS主网启动时所面临的问题：由于21个BP节点的限值过低而导致网络过于中心化。

安全性
Polkadot允许Parachain和Relay Chain共享“池安全”（pool security），而Cosmos则由Zone来保护自己的网络安全。这就意味着开始一个新的Parachain，就必须积累大量的Dots，并质押这些代币以便将Parachain连接到Polkadot 网络。因此每条Parachain的安全性根植于Dots本身，这样也就是在整个网络中创建了一个共享安全模型。

Cosmos允许Zone来管理自己的安全模型，也就是所谓的“Sovereign Zone”。这意味着，Cosmos Hub将使用治理决定哪些Zone可以接入Cosmos Hub。这个方案理论上可行，但是，如果恶意的Zone成功欺骗验证人相信它们是合法的，那它也确实可以接入网络。而一旦恶意的Zone连接到网络中，它就可能有多种方式攻击中央的Cosmos Hub，并从Cosmos网络中提取Atom。

通过Cosmos的Sovereign Zone，每个连接的Zone都必须自己创建一个安全的去中心化网络。所以，如果Cosmos Hub有5个完全可用的Zone，则可能会有100个Cosmos验证人，和5*100个Zone的验证人。这是一个比Polkadot更加去中心化的模型。如果正常工作起来，运行效果应该会很好。

可以想象，100个Polkadot验证人可以保护Relay Chain和5条Parachain，而Cosmos 网络则需要100个Hub验证人和500个Zone验证人。这也使得在Polkadot模型中，创建新的Parachain会相对更容易，但同时也意味着权力会集中到Dots所有者手中。而Cosmos是一个更加去中心化的安全模型，但实施起来也更困难。

但是，Cosmos团队也宣称，他们计划在主网上线后不久支持共享安全模型。一旦他们实现这个计划，将会给开发者带来极大的灵活性。因为开发者可以在Cosmos上共享基于Atom的安全性，或者创建自己的代币和安全体系。采取两种安全模型所作的取舍就是通过治理将Sovereign Zone添加到网络中，这也为恶意Zone连接到网络中提供了可能，尽管这种情况不大可能发生。

速度和可扩展性
两种共识协议的处理速度都可达每秒1000笔交易（1000 TPS）。这也取决于网络中有多少节点及网络相应的参数设置。对于增加的每个Parachain和Zone，它都会增加可处理的交易量，因而两种网络可以轻松达到1000 TPS的交易量。真正的瓶颈在于每个Zone和Parachain中运行的状态机程序。

可互操作性
两个网络都通过链中继（chain-relays）连接到一个中央枢纽。它们都通过Peg Zone/Bridges连接到以太坊主网，并致力于使这种连接更加迅速。另外，它们都可以快速、便捷地在各自网络上运行EVM Zone/EVM Parachain。Cosmos将在主网稳定后发布Ethermint，Polkadot可能也有类似的计划。

开发人员
Cosmos SDK和Polkadot Substrate都是为了开发平台而设计的。它们使得开发者可以更方便地在网络上创建自己的区块链。两方团队都致力于构建开发者友好型的新型开发平台，就像当初以太坊用智能合约和代币所做的那样。

在这两个平台上开发的不同之处主要在于，Polkadot使用WebAssembly和Rust语言，而Cosmos使用Golang语言。

Polkadot远见性地支持WebAssembly，以更好地面向未来。WebAssembly得到了Google, Apple, Microsoft 和 Mozilla的支持，很有可能在未来十年内得到广泛应用。Rust也一直努力成为可编译入WebAssembly的主要语言之一。在未来5年的展望中，Polkadot似乎在长期吸引开发者方面迈出了正确的一步。

然而，正如我们在以太坊上所看到的那样，有时首先进入市场甚为重要。还有其他支持智能合约的区块链允许使用其他语言编写智能合约，但以太坊几乎覆盖了所有的智能合约活动。正是因为他们建立了围绕Solidity和EVM的生态系统，而俘获了许多早期开发者的心。

Cosmos将率先推向市场。在Cosmos上开发的主要途径是通过Cosmos SDK中的Golang 语言，以及Lotion-JS——一个可基于Ethermint创建新链的Javascript实现工具。然而，Lotion-JS网站也表示Lotion-JS代码尚未通过安全审核，如果想保证安全性，则必须使用Cosmos SDK。

目前而言，Cosmos并没有支持WebAssembly的相关工作。但我们可以相信，Golang将很快增加对编译到WebAssembly的支持。他们已经取得了可观的进展。最后，与Rust相比，Golang是一种更易学习的编程语言，在全球也有更多的开发者。

主网启动
Cosmos将在2018年Q3发布。但Cosmos团队表示，在主网稳定前，他们将锁定交易，并且直到所有人都确信网络可以安全运行时才会开放回滚。

Polkadot将在2019年Q3发布，所以他们会给Cosmos一年的领先优势。


最近Cosmos已经上线，各种文章铺天盖地，从技术到经济模型，可以说对Cosmos解释的非常详细了，对比另一个热门Polkadot，Cosmos实现的是链上价值的互联，而Polkadot不仅实现链上价值互联，还能实现链上消息的互通，因此很多人认为Polkadot一出来会对Cosmos形成压倒性优势，我倒认为这两个链可能会长时间共存。

如果做个形象比喻，Polkadot是跨链界的IOS系统,而Cosmos是安卓系统。

从安全设计来说，Polkadot要求生态中所有的平行链都由dot代币来保证安全，形成一个统一封闭的安全池，而Cosmos中接入hub的链则是由自的代币和验证节点维护自己的安全，atom代币仅维护Cosmos这个中枢的安全。这个和安卓开放源码，谁都可以定制使用，而IOS系统必须由苹果来封闭使用的非常类似。

从应用开发设计来说，Polkadot聚焦于创建一个封闭跨链新生态，通过使用自身的Substrate框架来快速构建符合Polkadot标准的平行链，期望通过统一的标准来构建新的世界，Substrate当然也非常给力，支持各种已知的共识和模块，分分钟就能再造一条顶级链。Cosmos则希望创建一个开放的跨链生态，聚焦于现有链的整合，通过IBC协议和hub来实现目前各种已存链的对接和整合。

从这两个对比可以看到，Cosmos类似安卓，他不仅不会威胁到现有链，并且还会受到大部分链的拥护，因为Cosmos在不影响现有链共识和代币的基础上，增加了现有链的互通性和流动性。

Polkadot则类似IOS，他的Substrate对现有链形成了巨大的威胁，因为目前各种链的共识和功能他都能支持，并能分分钟搭建起来，甚至比绝大部分现有链更完善，并且要接入这个Polkadot，就要放弃自己的代币和安全，统一由DOT接管，这无疑是一个巨大的炸弹。估计现有链各个团队会对Polkaddot形成一定的抵制。

事情总有两面性，正因为以上特点，在初期估计Cosmos的用户体验会很差，可能有转账慢，操作复杂，甚至是锁币、丢币等各种问题，而Polkadot则会有优异的用户体验和系统稳定性。留给Cosmos的时间其实不多，如果Cosmos不能尽快的形成稳定生态，并快速迭代发展，很有可能被Pokadot围剿。



Intro to ABCI
Tendermint Core （“共识引擎”）通过一个满足 ABCI 标准的 socket 协议与应用进行交流。

举个大家比较熟悉的例子，比特币。比特币是一个加密货币区块链，其中的每个节点维护了一个完全经过审计的 UTXO 数据库。如果有人想要在 ABCI 之上创建一个类似比特币的系统，Tendermint Core 将会负责：

在节点间共享区块和交易
建立交易（区块链）的标准/不可变顺序
而应用将会负责：

维护 UTXO 数据库
验证交易的加密签名
阻止花费尚未存在的交易
允许客户端查询 UTXO 数据库
Tendermint 能够通过在应用过程和共识过程之间，提供一个非常简单的 API （也就是 ABCI）来分解区块链设计。

ABCI 包含了 3 个主要的消息类型，它们由 core 发送至应用。应用会对消息产生相应的回复。

消息的详细说明在这里：ABCI 消息类型。

DeliverTx 消息是应用的主要部分。链中的每笔交易都通过这个消息进行传送。应用需要基于当前状态，应用协议，和交易的加密证书上，去验证接收到 DeliverTx 消息的每笔交易，。一个经过验证的交易然后需要去更新应用状态 -- 比如通过将绑定一个值到键值存储，或者通过更新 UTXO 数据库。

CheckTx 消息类似于 DeliverTx，但是它仅用于验证交易。Tendermint Core 的内存池首先通过 CheckTx 检验一笔交易的有效性，并且只将有效交易中继到其他节点。比如，一个应用可能会检查在交易中不断增长的序列号，如果序列号过时，CheckTx 就会返回一个错误。又或者，他们可能使用一个基于容量的系统，该系统需要对每笔交易重新更新容量。

Commit 消息用于计算当前应用状态的一个加密保证（cryptographic commitment），这个加密保证会被放到下一个区块头。这有一些比较方便的属性。现在，更新状态时的不一致性会被认为是区块链的分支，分支会捕获所有的编程错误。这同样也简化了保障轻节点客户端安全的开发，因为 Merkel-hash 证明可以通过在区块哈希上的检查得到验证，区块链哈希由一个 quorum 签署。

一个应用可能有多个 ABCI socket 连接。Tendermint Core 给应用创建了三个 ABCI 连接：一个用于内存池广播时的交易验证，一个用于运行提交区块时的共识引擎，还有一个用于查询应用状态。



tendermint的SDK中包含了构造一个区块链节点旳绝大部分组件，例如加密算法、共识算法、 区块链存储、RPC接口、P2P通信等等，开发人员只需要根据其应用开发接口 （Application Blockchain Communication Interface）的要求实现自己 的应用即可。

ABCI是开发语言无关的，开发人员可以使用自己喜欢的任何语言来开发基于tendermint的 专用区块链。不过由于tendermint本身是采用go语言开发的，因此用go开发ABCI应用的一个额外好处 就是，你可以把tendermint完整的嵌入自己的应用，干净利落地交付一个单一的可执行文件。

tendermint的共识算法
在技术方面，tendermint引以为傲的是其共识算法 —— 世界上第一个可以应用于公链的拜占庭 容错算法。tendermint曾于2016年国际区块链周获得最具创新奖，并在Hyperledger的雨燕（Burrow） 等诸多产品中被采纳为共识引擎。你可以点击 这里 查看其应用案例。

tendermint采用的共识机制属于一种权益证明（ Proof Of Stake）算法，一组验证人 （Validator）代替了矿工（Miner）的角色，依据抵押的权益比例轮流出块：



由于避免了POW机制，tendermint可以实现很高的交易吞吐量。根据官方的说法，在 合理（理想）的应用数据结构支持下，可以达到42000交易/秒，引文参考 这里。 不过在现实环境中，部署在全球的100个节点进行共识沟通，实际可以达到1000交易/秒。

tendermint同时是拜占庭容错的（Byzantine Fault Tolerance），因此对于3f+1个 验证节点组成的区块链，即使有f个节点出现拜占庭错误，也可以保证全局正确共识的达成。同时 在极端环境下，tendermint在交易安全与停机风险之间选择了安全，因此当超过f个验证节点发生故障时，系统将停止工作。

什么是拜占庭错误？简单的说就是任何错误：既包括节点宕机、也包括恶意节点的欺骗和攻击。

tendermint共识机制的另一个特点就是其共识的最终确定性：一旦共识达成就是真的达成， 而不是像比特币或以太坊的共识是一种概率性质的确定性，还有可能在将来某个时刻失效。 因此在tendermint中不会出现区块链分叉的情况。



在上图中，tendermint结构中的abci应用和以太坊结构中的智能合约，都是由用户代码实现的。 显然，ABCI应用大致与EVM+合约的组合相匹配。

在以太坊中，节点是一个整体，开发者提供的智能合约则运行在受限的虚拟机环境中；而在 tendermint中，并不存在虚拟机这一层，应用程序是一个标准的操作系统进程，不受任何 的限制与约束 —— 听起来这很危险，但当你考虑下使用tendermint的目的是构建专有的区块链 时，这种灵活性反而更有优势了。

事实上，tendermint留下的应用层空间如此之大，以至于你完全可以在ABCI应用中实现一个 EVM，然后提供solidity合约开发能力，这就是超级账本的 Burrow 做的事情。


在之前的博客中，我们已经从一个更为宏观的视角了解了Cosmos/Tendermint技术栈。在本文中，我们将深入介绍Tendermint共识引擎的共识层和网络层。Cosmos-SDK将实现区块链的应用逻辑，它与Tendermint共识引擎一起实现区块链的三层架构：应用层、共识层、网络层。Tendermint共识引擎将共识的产生与p2p广播以一种创新方式结合在一起。在软件工程中，模块化的设计相比于整体化的设计在代码复用、代码库的维护上有明显的优势。



自上而下：应用层(Cosmos-SDK),ABCI,Tendermint共识引擎(共识+p2p网络)

Tendermint共识引擎也被称为Tendermint。Tendermint也是开发Tendermint共识引擎和Cosmos网络的公司的名称。Tendermint共识引擎是一种底层协议，它由两个协议组成：共识算法和p2p网络通信。Jae Kwon和Ethan Buchman受到了Raft和PBFT的启发，把Tendermint设计成一种容易理解、对开发人员友好的算法。Tendermint也可以用在复杂的系统中。

新一代的PoS BFT共识算法都参考了Tendermint如何在公有链领域运用基于BFT的PoS共识的方案。我们把这一类成功的借鉴称为Tendermint BFT。它们都属于基于BFT的PoS(与基于链的PoS相对)。若想要进一步了解基于链的PoS与BFT PoS的区别，可以参考这篇文章：Casper vs. Tendermint。

现在大家应该对Tendermint有了大致的了解，先就让我们进入正题：到底什么是Tendermint？它是如何工作的？

Tendermint BFT 协议栈



比特币创造了当今所有我们耳熟能详的区块链加密币系统的技术基础。Tendrmint 协议与比特币系统有很多相似之处，因为他们都是通过区块来纪录信息，但在解决"拜占庭将军"的问题(共识机制)上又各采取了不同的解决方案。Tendermint的体系可以追溯到学术界关于分布式计算以及拜占庭容错的研究（参见Ethan Buhman 的论文：

https://atrium.lib.uoguelph.ca/xmlui/bitstream/handle/10214/9769/Buchman_Ethan_201606_MAsc.pdf）。然而比特币的传奇故事是在多种电子现金支付系统失败之后（paypal除外）开始的，作为一种去中心化的无需进行审核的货币系统冉冉升起。

比特币的协议优化了去中心化的审核机制，这对于作为一种支付系统而诞生的比特币至关重要。而Tendermint，则是在多节点的广域网（如拥有百万节点的高节点数）中优化了分布式应用及数据处理方面的拜占庭容错。这种微妙的区别值得细究。

在全球的学术界里，关于广域网的拜占庭容错研究凤毛麟角，通常是基于拥有4–7个节点的单一管理权限的局域网研究。针对拥有大量节点及多个管理域下的广域网应用拜占庭容错的研究，基本找不到能应用于实践的重大突破。

2009年之前，当比特币向世界展示了其范式转变技术，也就是区块链概念时，如何解决节点数众多的广域网中的共识问题则一直找不到答案。尽管解决了"两将军问题"，但在理论以及分布式系统的研究方面，比特币并不是一个真正解决共识机制的算法。进一步完善拜占庭容错的研究还有很长路要走。

2014年，拥有计算机科学及系统工程背景的Jae Kwon设想了一种完全基于拜占庭容错的协议，通过POS(权益证明)作为底层的安全机制，可以应用于拥有数以百计节点的无许可环境。Tendermint从此诞生了。最终，这种基于POS(权益证明)作为主要的安全机制，并能在广域网中进行大量节点验证的的系统模型成为了一项异常复杂的工程实践，耗费四年时间才实现了项目公有链的落地。这个项目就是Cosmos,定于2018年夏上线。

模 型

Tendermint是一种在部分同步的环境下的固定性协议。它能在网络和各个进程本身的延迟范围内实现吞吐量。在 Vlad Zamfir给出的三角形中，Tendermint落在这条紫色的边中的某一个点上。



Vlad Zamfir的三角形说明了在共识协议中的几类权衡

FLP 不可能原理

Theorem "…我们呈现了一个令人惊讶的结论：在一个完全异步的共识协议下，即使一个线程的意外终止也可能导致共识过程的终止。" 也就是说，对于一个确定性的共识算法，在一个完全异步的环境中，如果出现了一个单线程的故障会导致共识的终止。

Dwork, Lynch和Stockmeyer在他们的文章Consensus in the Presence of Partial Synchrony，中写道："部分同步系统是介于同步系统和异步系统之间的一种形态。在同步系统中，系统的延迟有一个上限……这个上限是关于信息从一个进程传递到另一个进程，关于不同进程的处理速度……在部分同步的系统中没有延迟的上限。我们需要设计一个可以在部分同步的系统中使用的共识协议，它不受系统延迟的影响。"Tendermint的诞生就是为了解决这个问题。Tendermint 是一个改进版本的 的DLS 协议。

共识算法

部分同步，同步和异步通信

让我们通过一个众所周知的协议作为参考，来探索同步的案例，这个协议就是比特币协议。比特币里有一个概念称为"已知固定上限"，指的是比特币系统在挖矿的过程中每10分钟生成一个区块的规律。为了保证比特币系统能稳定地发展并不断产生区块，比特币的协议中人为地设置了这个10分钟规律，这使得系统中的所有节点可以利用这10分钟的时间，来完成接收，打包，见证的工作，同时将产生的交易在整个网络里进行广播。

以太坊是另一个这类协议的典型，其同步假设的出块时间仅为15秒。以太坊的出块速度较比特币的10分钟大幅缩短，这使得以太坊系统在产出速度上有更高的效率，交易在全网广播所费的时间更短，但也正因为如此，结果形成了许多孤立区块，使矿工蒙受了损失。

Tendermint 属于一种在部分同步通讯下解决一致性问题的协议，部分同步系统介于同步与异步概念之间，我们有时也称之为"弱同步"系统。这意味着，Tendermint 基于时序假设进行了改良，与同步系统不同，部分同比系统的速度提升并不是基于系统参数的改进，而是基于网络的速度。

响应性与终止性

定义：终止性指的是任何进程在运行完成后应该给出一个最终决定。

传统算法的同步模型大多依赖于同步假设，不仅是要保证运算进程的完成，更是要保证安全性，诸如中本聪共识，Peercoin, NXT, Snow White, Ouroboros等，这些算法都是为了同步系统而设计并且都设定了先验边界。一旦同步系统中的先验边界失效，共识机制就会被打破，链就会产生分叉。因此，例如比特币设定的10分钟出块的规则，是出于一种对于主链安全性的适当保护。

Tendermint 则与之不同，只要出现问题的进程不超过1/3，那系统就不会出现分叉这样的异步性问题。这种特性使Tendermint成为了一种基于拜占庭容错的权益证明协议，而协议中安全性的保障又高于响应性能（CAP定理：分布式系统中，Consistency(一致性), Availability(可用性)，Partition tolerance(分区容忍性)不可兼容）。最终，Tendermint 区块链将在绝对大多数节点（比如超过2/3）完成共识见证后终止进程。

现在也有些同步协议存在于异步网络中，但是依据FLP不可能性（FLP impossibility是一个定理，它证明了在分布式情景下，无论任何算法，即使是只有一个进程挂掉，对于其他非失败进程，都存在着无法达成一致的可能。），这些协议不可能同时达成一致性决议。

确定性与非确定性 协议

在完全异步的情况下解决共识问题的非确定性协议潜在地依赖于随机预言和普遍地导致信息复杂度的开销，因为它们所有的通信都依赖于可靠的广播。在异步环境下，单个可靠的广播的开销大约和Tendermint中的一轮共识的花费是相当的。像HoneyBadger拜占庭容错这样的很多协议属于在异步环境下的非确定性协议一类。通常，它们要求在单轮的通信中要有三个可靠的广播实例。

相反Tendermint是一个完全确定性的协议；无论什么情况下在这个协议中都没有随机性。通过实现中的一个确定的数学函数，领导是很明确的被选举出来的。这样，我们能够在数学上证明这个系统是活的，并且这个协议能够保证做出决策。

轮流担任Leader

Tendermint 以加权的轮询方式在验证者集合，即如新区块的提出者们中循环产生。一个验证者和其委托人抵押的权益越多，它就有更多的权重，并且相应地它就会被更多的选为领导者。具体来说明一下，如果一个验证者和另一个验证者有着同样的权重，它们都会被协议以同样的次数选中。

对于这个算法如何工作的

最简单的解释如下：

验证者的权重被设置
验证者被选择，轮到验证者来提议一个区块
权重被重新计算，在本轮结束后减少一定数量的权重
随着每一轮的进行，权重按照投票权利的相应比例逐渐递增
再一次选择验证者
实际对应的代码实现:

https://github.com/tendermint/tendermint/blob/master/types/validator_set.go#L50

因为协议可以很明确地选择区块的提案人，鉴于你知道验证者集合和每个验证者的投票权重，你可以在x, x + 1,…,x + n 轮次中准确地计算出谁会是下一个区块的提案者。因此，有评论者争论说Tendermint去中心化的还不够。当你可以预知谁会是领导者的时候，一个攻击者可以以这些领导者为目标并对他们发动DDoS攻击，而且很有可能使得这个链停止向前发展。我们通过在Tendermint中实现某个叫做哨兵架构的设计来减轻这个攻击路径的影响。

P2P网络协议

轮流担任Leader

随着Cosmos网络的影响范围不断变大，网络也会经常遭受攻击，比如说DoS。一个有效的哨兵节点架构将保证验证人节点的IP不被暴露出来，同时可以组织其他节点与验证人节点连接。 这样可以混淆验证人节点的真实位置。

也就是说，哨兵节点的架构是可选择的。验证人有责任维护一个抗攻击的全节点。 这是我们根据经济激励做出的额外假设。 假设是，验证人会希望采取所有预防措施，以保持容错，保持高可用，并最终在保持在共识过程中发挥其作用。 因为如果他们不这样做，他们会因为长期离线被强制剔除出验证人集合。

Peer Exchange (PEX) Reactor

Tendermint继承了比特币的节点发现机制。Tendermint沿用了btcd的p2p AddressBook，比特币在golang中的实现。在默认的的配置中将默认支持节点的发现。

Tendermint 实践

除了新颖的算法设计和学术术语之外，Tendermint还有什么用处呢?

坏消息是每天都有人觉得Tendermint没有用。好消息是应用程序开发人员可以跨越协议和最终用户之间的鸿沟。Tendermint被设计为可自定义且灵活的，足以满足任何设置的。无论是公共的还是企业的，他们都需要这样的一个共识协议。

对于想要在自己的区块链之上实现应用程序的开发人员来说，Tendermint非常理想。它是预先装配好的，所以如果开发人员想选择运行一个纯粹的基于BTF容错的POS共识引擎为他们的去中心化应用分区提供支撑，Tendermint可以很容易地做到这一点。

当用户使用Cosmos-SDK实现他们的高级业务逻辑时，有趣的部分就出现了。为了与Tendermint的共识/网络层进行连接，我们通过一个Tendermint套接字协议来完成，我们称之为区块链接口，或者ABCI。

Application Layer: Cosmos-SDK (Blockchain Application Framework)
Cosmos-SDK Alpha Release
TendermintABCI：http://tendermint.readthedocs.io/projects/tools/en/master/introduction.html#abci-overview
正在进行的研究

目前，我们正在深入研究BLS签名，这可能会导致Tendermint块头的大小从3.2 KB(带有~100验证器)减少到64字节。



Cosmos与波卡两个备受瞩目的跨链项目有何不同
Elecy  3周 前 1,653
两个项目一致共识从安全出发，这给我很大的体悟，从安全为起点思考这两个项目才是正确的方向。初视波卡与Cosmos觉得两个项目挺像的，都是基于中继链/侧链的跨链解决方案，后来为了写这篇对比文章找了很多资料，逐渐的发现设计哲学对项目后续发展不同的影响，得出了一点心得，欢迎大家一起讨论。
每个人看项目的角度都不一样，安全重要？扩展重要？生态重要？哪一个要先发展？

在波卡与Cosmos开发人员的问答直播里，答案明显呼之欲出，两个项目一致共识从安全出发，这给我很大的体悟，从安全为起点思考这两个项目才是正确的方向。

没有安全就没有根基，为什么早些时候货币是金银，因为很难伪造，为甚么政府要在纸钞上做出这么多花样，因为假钞扰乱了真钞，正如这些货币，区块链上的加密货币一样如此，一条链出现了双花攻击，凭空造币等安全问题，那这条链大概率就声誉全毁，技术及远景再牛逼都是一场空。

以下开始正题：
第一个不同点：Cosmos与波卡两个跨链项目在安全上不同的设计哲学

Cosmos强调自治，希望能有一个更自由更自主的跨链生态，白话说如果一条链是一个国家，Cosmos这个大世界里，每个国家都有自己的军队与主权维护安全，所以在中心Hub和区域Zone上各自的验证人节点不同，自行维护安全。

Polkadot强调团结，希望更多的项目团结来增加跨链生态的安全，白话说在Polkadot这个大世界，大家共同建立一个联合政府，联合政府会指派军队去保护各个区域安全，所以在Polkadot上，中心Relaychain与区域Parachain的验证人节点统一由Polkadot系统分配。

第二个不同点：这样的安全设计理念下两者各自会遇到什么样的恶意攻击呢？

Cosmos下，中心Hub与区域Zone各是不同国家，每个国家负责安全的军队都不同，当跨链场景从ZoneA 到Zone B发生时，外部人怎么知道ZoneA 与Zone B的军队（验证人）是善良诚实的？在高速复杂的跨链场景下，某一个Zone被攻击后，可以发出虚假信息进而扰乱整个Cosmos大系统。

Polkadot下，所有军队（验证人节点）由Polkadot随机挑选并分发到不同区域（Parachain）上，如果随机分配到Parachain上的一群节点，是互相勾结的坏人，那外部人就有理由怀疑上面发生的跨链交互是有问题的。

如何解决呢？两者各有应对方案，在理想情况下

Cosmos本身团队是Tendermint出身，Tendermint团队深耕于在区块链上实现拜占庭容错，拜占庭容错能容许一定节点作恶下，系统依然不崩溃而正常运行，所以Cosmos有底气设计这样的自治生态，同时Cosmos的Hub中心会有一个全局观的代币状态，在最重要币的安全上，中心Hub有责任去检验不同区域Zone上的操作是否真的有这么多数量的代币，如果发现全局观的代币记录与分区上代币记录不一致，可以将中心Zone与区域Hub间的联系中断，有效遏止作恶引起的系统崩溃，具体实现等Cosmos上线后将会有更多的讨论。

Polkadot通过随机挑选验证人节点，维护每一条围绕Polkadot的链，当可以被随机挑选的验证人池子越大，那就会越公平与安全，想作恶的一群人被划分在一起的概率会下降，所以Polkadot官方希望有1000个节点来维护Polkadot这条链, 同时加入钓鱼人Fisherman这项角色，作为系统内警察，通过揪出作恶操作获得奖励来进一步加强系统安全。

PS: 真实的攻击和变化肯定更多，我不是安全专家，只是举了最容易了解的攻击形式

第三个不同点：安全设计哲学下如何影响代币价值与生态发展

币价和安全性有什么关系？

我们都知道比特币里一部分的安全是由矿工运行矿机来保证，算力成本的高低和币价有一定关联性（虽然不是直接因果关系），在PoS共识下，没有实体矿机，大家手中的币就是矿机，币通过委托代理Stake进行挖矿，同时维护链的安全，如果要攻击一条PoS的链，攻击代价就是控制1/2甚至要到2/3比例的代币。

先说Polkadot共享安全shared security的概念（就是前面提到的团结哲学），Polkadot认为不是每一个新的区块链都可以找到这么多节点来维护安全（事实也是如此，很多新公链最大问题就是节点不够，不够就代表不去中心化不够安全），Polkadot说我提供大家安全性，大家的链接入到我整个系统，所以Dot代币将来提供的不仅仅是Polkadot自身安全，还包挂围绕在Polkadot旁Parachain的安全，可想而知Dot用途更广了，价值也扩大了。

Cosmos强调了自治思想，所以每个区域Zone需要自己的验证人节点提供安全，在PoS共识架构下，每个自治Zone的代币都承担了安全保护的功能与价值，但同时Cosmos原生代币Atom的用途也相对Dot减少了。

反过来想Polkadot的模式其实是抢夺了其它链原生代币安全保护的功能与价值，建立在Polkadot上的链就只剩下本身业务场景才能撑起币的市值（打了一个大大折扣），所以我猜测一个希望自己做大（市值高），有自主权的链，会选搭建在Cosmos之上。

当然Cosmos也有在讨论提供共享安全性的想法，以现阶段区块链还在早期的阶段，市场上确实没有足够且去中心化的验证人节点来为新的区块链服务（必须要有足够的经济诱因），我认为共享安全性是一个不错的点子。

第四个不同点：瞄准场景的不同

Cosmos专注在代币流动的领域，还有支持跨链下使用代币进行的物件化模块功能调用。

Polkadot专注在整个信息的流动，其它Parachain的最终共识由Polkadot提供，使Polkadot的中心Relaychain在记录整个网络的所有信息状况更容易，Polkadot上可以做到直接调用其它链上的智能合约。

两个项目其实都可以向外扩展，或是向某个方向专注，特化下自然会形成两者各自的特色而吸引各自的项目开发者与使用者。

最后一些有趣的讨论

1. 不管是Cosmos和Polkadot都要面临验证人节点不足的问题，从我们参与社区的观察，一条链拥有超过100个不同背景的验证人节点现阶段是很难的（短期内区块链还没有发展那么广为人知，可能由基金会自己运行，投资机构运行，或同一个团队运行多个节点来满足）

2. Cosmos, Polkadot及Tezos, 这三个项目的验证人节点有很大一部分重叠，作恶问题，垄断问题可能发生，是一个有趣的事实。

3. 项目开发进度与回应速度，我会比较担心Cosmos，Cosmos项目已经延期，而且从我们递交给官方信息的反馈速度来看，Polkadot远胜Cosmos。

4. 跨链项目不会这么快，观察他们如何完美的解决连接以太坊及比特币再说，这两个最主要的区块链社区，互相连接上了才会有更多的交互的创意与应用，连接以太坊是这两个项目上线后最主要的目标，同时他们也提到连接比特币更困难，但还没有确定时间轴。

5. Cosmos团队提到2019年要开始宣传可组合型Composibility，Cosmos SDK是一个可以节省开发者大量时间的工具包，内置委托代理，治理，跨链等基础功能模块，Polkadot也做了一个类似工具包Substrate。除了设计哲学，谁能更好的说服及宣传自己的工具包，谁就能掌握更多的开发者。





Tendermint是一个能够在不同机器上，安全一致复制应用的软件，其中安全性和一致性也是分布式账本的关键概念。
Tendermint具备拜占庭容错能力，是一种拜占庭容错共识算法。
Tendermint主要有两部分组成：
Tendermint Core：区块链共识引擎，负责节点之间数据传输以及拜占庭共识。
ABCI：区块链应用程序接口，也是一个协议，支持任何语言的交易处理实现。
总体来讲，Tendermint可以理解为一个模块化的区块链软件框架，支持开发者个性化定制自己的区块链，而又不需要考虑共识以及网络传输的实现。


Tendermint设计原则

先简单说说区块链的概念，区块链是一个具备确定性的状态机，可以在不信任的节点之间进行状态复制，包括应用的状态和改变状态的交易。从架构的层面上，区块链可以简单分为三个概念层：

网络层（Networking）：负责交易和数据传输和同步。
共识算法（Consensus）：负责不同的验证节点处理完交易后，保证状态的一致，也就是将交易打包到区块中。
应用程序（Application）：交易的真正执行者。

目前大部分的区块链实现都是采用上面的框架，实现成单一的程序，但是这就很容易出现两个问题：

代码复用困难，代码库的分支管理变得复杂。
限制了应用开发的语言。
如何去规避这两个问题呢？Tendermint设计了自己的一套框架，其设计原则是易使用，易理解，高性能，适用于各种分布式应用。它的创新之处在于，将区块链应用（状态）与底层共识进行了分离，将共识引擎和P2P网络层封装组成Tendermint Core。同时提供ABCI接口与应用层进行交互，应用逻辑可以用任何语言编写，应用做的事情实际上就是状态机控制。基于这种架构，应用的开发者可以方便地实现自己的区块链。


Tendermint的框架总体来讲分为ABCI Application以及Tendermint Core两部分，两者通过ABCI连接。下面会对这两部分依次展开介绍。

Tendermint核心模块

ABCI Application

开发者定制开发的区块链应用，开发语言不受限制，可以使用任何语言进行开发，但是必须实现为一个ABCI Server，即需要满足以下几点：

是一个Socket Server，需支持TSP或GRPC两种方式之一。
能够处理ABCI Message。所有的ABCI消息类型都是通过protobuf来定义的，具体的消息格式可参考https://github.com/tendermint/abci/blob/master/types/types.proto
实现区块链应用接口（ABCI）。ABCI是Tendermint中定义的一套Application与Tendermint Core之间交互的协议。详细定义如下（版本：0.10.3）：


ABCI接口可以分为三类：信息查询、交易校验以及共识相关处理。而Tendermint Core作为ABCI Client在启动时，会与ABCI Server建立三个连接，分别用于这三类接口消息的处理。

在Tendermint Core与Application交互的所有消息类型中，有3种主要的消息类型：

CheckTx消息用于验证交易。Tendermint Core中的mempool通过此消息校验交易的合法性，通过之后才会将交易广播给其它节点。
DeliverTx消息是应用的主要工作流程，通过此消息真正执行交易，包括验证交易、更新应用程序的状态。
Commit消息通知应用程序计算当前的世界状态，并存在下一区块头中。

Tendermint Core

Tendermint共识引擎，包含区块链需要大部分功能实现，主要有：

共识算法：拜占庭POS算法。
P2P：采用gossip算法，默认端口是46656。
RPC：区块链对外接口，默认端口是46657。支持三种访问方式：URI over HTTP、JSONRPC over HTTP、JSONRPC over websockets。详细的RPC接口定义列表可以参考https://tendermint.github.io/slate
其它：交易缓存池、消息队列等。

1）共识算法

Tendermint是一个易于理解的BFT共识协议。协议遵循一个简单的状态机，如下：

协议中有两个角色：

验证人：协议中的角色或者节点，不同的验证者在投票过程中具备不同的权力（vote power）。
提议人：由验证人轮流产生。
验证人轮流对交易的区块提议并对提议的区块投票。区块被提交到链上，且每个区块就是一个区块高度。但区块也有可能提交失败，这种情况下协议将选择下一个验证人在相同高度上提议一个新块，重新开始投票。

从图中可以看到，成功提交一个区块，必须经过两阶段的投票，称为pre-vote和pre-commit。当超过 2/3 的验证人在同一轮提议中对同一个块进行了pre-commit投票，那么这个区块才会被提交。

由于离线或者网络延迟等原因，可能造成提议人提议区块失败。这种情况在Tendermint中也是允许的，因为验证人会在进入下一轮提议之前等待一定时间，用于接收提议人提议的区块。

假设少于三分之一的验证人是拜占庭节点，Tendermint能够保证验证人永远不会在同一高度重复提交区块而造成冲突。为了做到这一点，Tendermint 引入了锁定机制，一旦验证人预投票了一个区块，那么该验证人就会被锁定在这个区块。然后：

该验证人必须在预提交的区块进行预投票。
当前一轮预提议和预投票没成功提交区块时，该验证人就会被解锁，然后进行对新块的下一轮预提交。



可以看到，Tendermint共识算法和PBFT时非常相似的，可以说是PBFT的变种，那我们来比较一下：
相同点：
同属BFT体系。
抗1/3拜占庭节点攻击。
三阶段提交，第一阶段广播交易（区块），后两阶段广播签名（确认）。
两者都需要达到法定人数才能提交块。
不同点：
Tendermint与PBFT的区别主要是在超过1/3节点为拜占庭节点的情况下。当拜占庭节点数量在验证者数量的1/3和2/3之间时，PBFT算法无法提供保证，使得攻击者可以将任意结果返回给客户端。而Tendermint共识模型认为必须超过2/3数量的precommit确认才能提交块。举个例子，如果1/2的验证者是拜占庭节点，Tendermint中这些拜占庭节点能够阻止区块的提交，但他们自己也无法提交恶意块。而在PBFT中拜占庭节点却是可以提交块给客户端。
另一个不同点在于拜占庭节点概念不同，PBFT指的是节点数，而Tendermint代表的是节点的权益数，也就是投票权力。
最后一点，PBFT需要预设一组固定的验证人，而Tendermint是通过要求超过2/3法定人数的验证人员批准会员变更，从而支持验证人的动态变化。


2）P2P网络

Tendermint的P2P网络协议借鉴了比特币的对等发现协议，更准确地说，Tendermint是采用了BTCD的P2P地址簿（Address Book）机制。当连接建立后，新节点将自身的Address信息（包含IP、Port、ID等）发送给相邻节点，相邻节点接收到信息后加入到自己的地址薄，再将此条Address信息，转播给它的相邻节点。

此外为了保证节点之间数据传输的安全性，Tendermint采用了基于Station-to-Station协议的认证加密方案，此协议是一种密钥协商方案，基于经典的DH算法，并提供相互密钥和实体认证。大致的流程如下：

每一个节点都必须生成一对ED25519密钥对作为自己的ID。
当两个节点建立起TCP连接时，两者都会生成一个临时的ED25519密钥对，并把临时公钥发给对方。
两个节点分别将自己的私钥和对方的临时公钥相乘，得到共享密钥。这个共享密钥对称加密密钥。
将两个临时公钥以一定规则进行排序，并将两个临时公钥拼接起来后使用Ripemd160进行哈希处理，后面填充4个0，这样可以得到一个24字节的随机数。
得到的随机数作为加密种子，但为了保证相同的随机数不会被相同的私钥使用两次，我们将随机数最后一个bit置为1，这样就得到了两个随机数，同时约定排序更高的公钥使用反转过的随机数来加密自己的消息，而另外一个用于解密对方节点的消息。
使用排序的临时公钥拼接起来，并进行SHA256哈希，得到一个挑战码。
每个节点都使用自己的私钥对挑战码进行签名，并将自己的公钥和签名发给其它节点校验。
校验通过之后，双方的认证就验证成功了。后续的通信就使用共享密钥和随机数进行加密，保护数据的安全。
应用示例

Tendermint官方项目里内置了ABCI Application的两个简单实现counter以及kvstore。这个两个Demo逻辑非常简单，运行起来也非常简单，以kvstore为例，只需要下面三条简单的指令就可以轻松的跑起来：

tendermint init

abci-cli kvstore

tendermint node


复杂一点，假设想使用Tendermint实现一套类似Ethereum的应用，最终应该是这样：

由Tendermint Core负责交易和区块的共享以及共识处理，开发者只需将go-ethereum和ABCI Server集成一个ABCI应用。Ethermint项目就是Tendermint团队开发的一个类似应用，大家可以参考，遗憾的是目前Ethermint目前只支持低版本的abci和go-ethereum。

Tendermint工作流
上图简单描述了Tenermint的工作流。大致为：

client通过RPC接口broadcast_tx_commit提交交易；
mempool调用ABCI接口CheckTx用于校验交易的有效性，比如交易序号、发送者余额等，同时订阅交易执行后的事件并等待监听。
共识从mempool中获取交易开始共识排序，打包区块，确定之后依次调用ABCI相关接口更新当前的世界状态，并触发事件。
最终将交易信息返回client。
总结

本文从概念、设计原则以及架构等方面对Tendermint做了详细的介绍，让大家可以直观了解到Tendermint的设计思想和实现原理。了解Tendermint之后，方便大家：

可以快速开发出自己的区块链应用而无需关注共识和P2P网络。
能够很好的兼容到Cosmos跨链生态中，因为Tendermint是Cosmos的核心技术。
开发支持任何编程语言的区块链。

